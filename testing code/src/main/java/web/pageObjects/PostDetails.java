package web.pageObjects;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import web.AbstractComponents.AbstractComponent;
import web.constants.PageConstants;

import java.awt.*;
import java.awt.datatransfer.DataFlavor;
import java.util.List;

public class PostDetails extends AbstractComponent {

    /**
     * this is the webDriver through which we can run the tests
     */
    WebDriver driver;

    /**
     * this is the textbox through which we will input the comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement commentTextBox;

    /**
     * this is the button to press when making a comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement commentButton;

    /**
     * these are comments Texts in the post comments
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    List<WebElement> comments;

    /**
     * these are people who made comments on a post
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    List<WebElement> commentPeople;

    /**
     * this is the button to share a post
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement shareButton;

    /**
     * this is sharing using copying the link
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement copyLinkBtn;

    /**
     * this is the button that's used to upvote the current post
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement upVotePostBtn;

    /**
     * this is the button that's used to downvote the current post
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    WebElement downVotePostBtn;

    /**
     * this is the list of buttons that's used to downvote a specific comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    List<WebElement> downVotesCommentsBtn;

    /**
     * this is the list of buttons that's used to upvote a specific comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    List<WebElement> upVotesCommentsBtn;

    /**
     * this is the text that holds the number of upvotes for a specific comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    By upVotesCommentText;

    /**
     * this is the text that holds the number of downvotes for a specific comment
     */
    @FindBy(id = PageConstants.NULL_LOCATOR)
    By downVotesCommentText;

    /**
     * this is the constructor of the class and it initializes all of its members using PageFactory class
     *
     * @param driver : which is generated by selenium testcase
     */
    public PostDetails(WebDriver driver) {
        super(driver);
        this.driver = driver;
    }

    /**
     * this method is used to make a comment
     * @param comment: this is the string to be inserted as a comment
     */
    public void makeComment(String comment){
        commentTextBox.sendKeys(comment);
        commentButton.click();
    }

    /**
     * this method gets the comment made by a specific user
     * @param userName: this is the name of the user who made this comment
     * @return String: the comment made by the user given as input
     */
    public String getCommentOfUser(String userName){
        int index = commentPeople.indexOf(userName);
        if(index != -1)
            return comments.get(index).getText();
        else
            return "";
    }

    /**
     * this function is to share a link and get that link
     * @return String: the link to be shared
     */
    public String shareLink(){
        shareButton.click();
        waitForWebElementToAppear(copyLinkBtn, 1);
        copyLinkBtn.click();
        try {
            return (String) Toolkit.getDefaultToolkit().getSystemClipboard().getData(DataFlavor.stringFlavor); // extracting the text that was copied to the clipboard
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * this function returns the name of someone at specific position in the comments section
     * @param index: this is the index that we want the name of user at
     * @return String: the name of the username at the given index
     */
    public String getUserNameOfIndex(int index){
        return commentPeople.get(index).getText();
    }

    /**
     * this function is used to upvote a post
     */
    public void upVotePost(){
        upVotePostBtn.click();
        driver.navigate().refresh();
    }

    /**
     * this function is used to downvote a post
     */
    public void downVotePost(){
        downVotePostBtn.click();
        driver.navigate().refresh();
    }

    /**
     * this function is used to downvote a comment
     */
    public void downVoteComment(String userName){
        int index = commentPeople.indexOf(userName);
        downVotesCommentsBtn.get(index).click();
        driver.navigate().refresh();
    }

    /**
     * this function is used to upvote a comment
     */
    public void upVoteComment(String userName){
        int index = commentPeople.indexOf(userName);
        upVotesCommentsBtn.get(index).click();
        driver.navigate().refresh();
    }

    /**
     * this methods the number of upvotes on a post
     * @return int: the number of upvotes on a post
     */
    public int getNumOfUpvotePost(){
        return Integer.parseInt(upVotePostBtn.getText());
    }


    /**
     * this methods the number of downvotes on a post
     * @return int: the number of downvotes on a post
     */
    public int getNumOfDownvotePost(){
        return Integer.parseInt(upVotePostBtn.getText());
    }

    /**
     * this methods the number of upvotes on a comment
     * @return int: the number of upvotes on a comment
     */
    public int getNumOfUpvoteComment(String userName){
        int index = commentPeople.indexOf(userName);
        return Integer.parseInt(commentPeople.get(index).findElement(upVotesCommentText).getText());
    }

    /**
     * this methods the number of upvotes on a comment
     * @return int: the number of upvotes on a comment
     */
    public int getNumOfDownvoteComment(String userName){
        int index = commentPeople.indexOf(userName);
        return Integer.parseInt(commentPeople.get(index).findElement(downVotesCommentText).getText());
    }

}
